<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Cesium - Edmonton View</title>
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.120/Build/Cesium/Cesium.js"></script>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.120/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <style>
        html,
        body,
        #cesiumContainer {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <input type="checkbox" id="toggleAlberta" onclick="toggleAlberta()" checked>
    <label for="toggleAlberta">Toggle Alberta Outline</label>
    <div id="cesiumContainer"></div>
    <script>
        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIwZWZmNzNkNy01YmUzLTQ4YjgtOWJhZi05NDZhZmY3ZTlkY2UiLCJpZCI6MzAxMzUxLCJpYXQiOjE3NDk5NjUzMzh9.GkpUJoqxZ2vucGMCqKASf0Rcsa_XQsFZ6DD8HHIp6j4';

        const viewer = new Cesium.Viewer("cesiumContainer", {
            terrainProvider: Cesium.Terrain.fromWorldTerrain(),
            timeline: false,
            animation: false
        });

        let airportsLayer, railsLayer;

        async function init() {
            const osmBuildingsTileset = await Cesium.createOsmBuildingsAsync();
            viewer.scene.primitives.add(osmBuildingsTileset);
            viewer.scene.setTerrain(Cesium.Terrain.fromWorldTerrain());
            const imageryLayer = viewer.imageryLayers.get(0);
            imageryLayer.brightness = 0.5;

            //viewer.imageryLayers.removeAll();
            viewer.scene.globe.baseColor = Cesium.Color.RED;

            viewer.scene.backgroundColor = Cesium.Color.BLACK;
            viewer.scene.skyAtmosphere.show = false;
            viewer.scene.fog.enabled = false;
            viewer.scene.globe.showGroundAtmosphere = false;

            const fiber = (await (await fetch('https://regionaldashboard.alberta.ca/scripts/fibre_area_s.js')).json());
            const {features, type} = fiber;
            const [bad, ok, good] = features;

            const rails = (await fetch('https://regionaldashboard.alberta.ca/scripts/rail_tracks.js')).json();

            const airports = (await fetch('https://regionaldashboard.alberta.ca/scripts/airports.js')).json();

            const transmissionLines = (await fetch('https://regionaldashboard.alberta.ca/scripts/transmission_lines.js')).json();

            const highways = (await fetch('https://regionaldashboard.alberta.ca/scripts/l1_roads.js')).json();
            const albertaOutline = (await fetch('./alberta_outline.json')).json();

            const geoJsonData = {
                "type": "FeatureCollection",
                "features": [
                    {
                        "type": "Feature",
                        "properties": {
                            "name": "hEEHE",
                            "description": "This is a test description for the point.",
                            "testField": "test value"
                        },
                        "geometry": {
                            "coordinates": [
                                -113.52518756872853,
                                53.52849345148286
                            ],
                            "type": "Point"
                        }
                    }
                ]
            }

            Cesium.GeoJsonDataSource.load(rails, {
                clampToGround: true,
                stroke: Cesium.Color.fromCssColorString('#ff008a'),
                strokeWidth: 10,
                fill: Cesium.Color.TRANSPARENT
            }).then(function (dataSource) {
                viewer.dataSources.add(dataSource);

                // Loop through entities and apply glowing material
                const entities = dataSource.entities.values;
                for (let i = 0; i < entities.length; i++) {
                    const entity = entities[i];
                    if (Cesium.defined(entity.polyline)) {
                        entity.polyline.material = new Cesium.PolylineGlowMaterialProperty({
                            glowPower: 0.6,                // 0 (soft) to 1 (intense)
                            color: Cesium.Color.HOTPINK    // Any Cesium color
                        });
                        entity.polyline.width = 10;
                    }
                }
            });

            Cesium.GeoJsonDataSource.load(transmissionLines, {
                clampToGround: true,
                stroke: Cesium.Color.fromCssColorString('#d78e12'),
                strokeWidth: 10,
                fill: Cesium.Color.TRANSPARENT
            }).then(function (dataSource) {
                viewer.dataSources.add(dataSource);

                // Loop through entities and apply glowing material
                const entities = dataSource.entities.values;
                for (let i = 0; i < entities.length; i++) {
                    const entity = entities[i];
                    if (Cesium.defined(entity.polyline)) {
                        entity.polyline.material = new Cesium.PolylineGlowMaterialProperty({
                            glowPower: 0.6,                // 0 (soft) to 1 (intense)
                            color: Cesium.Color.ORANGE    // Any Cesium color
                        });
                        entity.polyline.width = 10;
                    }
                }
            });

            Cesium.GeoJsonDataSource.load(highways, {
                clampToGround: true,
                stroke: Cesium.Color.fromCssColorString('#1B15F0'),
                strokeWidth: 10,
                fill: Cesium.Color.TRANSPARENT
            }).then(function (dataSource) {
                viewer.dataSources.add(dataSource);

                // Loop through entities and apply glowing material
                const entities = dataSource.entities.values;
                for (let i = 0; i < entities.length; i++) {
                    const entity = entities[i];
                    if (Cesium.defined(entity.polyline)) {
                        entity.polyline.material = new Cesium.PolylineGlowMaterialProperty({
                            glowPower: 0.6,                // 0 (soft) to 1 (intense)
                            color: Cesium.Color.BLUE    // Any Cesium color
                        });
                        entity.polyline.width = 10;
                    }
                }
            });

            Cesium.GeoJsonDataSource.load(airports, {
                clampToGround: true,
                markerSymbol: 'airfield'
            }).then(function (dataSource) {
                viewer.dataSources.add(dataSource);
            });

            const albertaOutlineTemp = await Cesium.GeoJsonDataSource.load(albertaOutline, {
                clampToGround: true,
            });
            viewer.dataSources.add(albertaOutlineTemp);


            viewer.scene.camera.flyTo({
                destination: Cesium.Cartesian3.fromDegrees(-113.4909, 53.5444, 750), // Edmonton
                orientation: {
                    heading: Cesium.Math.toRadians(20),
                    pitch: Cesium.Math.toRadians(-20)
                },
                duration: 0
            });
            return albertaOutlineTemp;
        }


        const result = init();
        const toggleAlberta = () => {
            result.then((dataSource) => {
                dataSource.show = !dataSource.show;
            });

        }
    </script>

</body>

</html>
